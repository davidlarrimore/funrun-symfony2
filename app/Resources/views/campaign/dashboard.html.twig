{% extends 'template.html.twig' %}

{% block css %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/dt-1.10.12/fh-3.1.2/r-2.1.0/sc-1.4.2/datatables.min.css"/>
{% endblock %}

{% block body %}
    <div class="container">
    <div class="row">
    <div class="col-md-12">
        <img class="img img-responsive center-block" src="/assets/img/FunRun2016-FBbanner.png"/>
    </div>
    </div>
    </div>
    <div class="row dashboard">
        <div class="col-sm-12">
            <div class="panel panel-info" data-mh="row-1" style="text-align:center;vertical-align: middle;">
                <div class="panel-heading">Overall Campaign Progress, as of -
                    <strong>{{ report_date|date("l, F d, Y") }}</strong>
                </div>
                <div class="panel-body dashboard-ticker">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="progress">
                                <div
                                    class="progress-bar progress-bar-warning"
                                    role="progressbar"
                                    aria-valuenow="{{ totals.donation_amount / campaign.fundingGoal * 100}}"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                    style="width:{{ totals.donation_amount / campaign.fundingGoal * 100}}%">
                                    <span>{{ (totals.donation_amount / campaign.fundingGoal * 100)|number_format(2, '.', ',')}}% Complete</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4" style="text-align:center;vertical-align: middle;">
                            <strong>
                                ${{ totals.donation_amount|number_format(2, '.', ',') }}
                                / ${{ campaign.fundingGoal|number_format(2, '.', ',') }}</strong>
                        </div>
                        <div class="col-sm-4" style="text-align:center;vertical-align: middle;">
                            <div id="track" data-countdown="{{ campaign.endDate|date('Y/m/d') }}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-info">
                <div class="panel-heading">Recent Class Awards -
                    <a href="{{ path('public_classroom_awards', {'campaignUrl':campaign.url}) }}">
                        <small>(click here to view all)</small>
                    </a>
                </div>
                {% if new_classroom_awards | length > 0 %}
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>Date Earned</th>
                                <th>Classroom</th>
                                <th>Total Donations</th>
                                <th>Award Level</th>

                            </tr>
                        </thead>
                        <tbody>
                            {% for classroom in new_classroom_awards %}
                                <tr>
                                    <td>{{ classroom.donated_at|date("D, M d") }}</td>
                                    <td>
                                        <a href="{{ path('classroom_show', { 'campaignUrl': campaign.url, 'id': classroom.id }) }}">
                                            <span class="hidden-xs">{{ classroom.grade_name }}
                                                -</span>
                                            {{ classroom.classroom_name }}</a>
                                    </td>
                                    <td>${{ classroom.cumulative_donation_amount|number_format(2, '.', ',') }}
                                        <span class="hidden-xs">
                                            <small>(<span style="color:#5cb85c;">+{{ classroom.donation_amount|number_format(2, '.', ',') }}</span>)</small>
                                        </span>
                                    </td>
                                    <td>${{ classroom.campaignaward_amount }}
                                        -
                                        {{ classroom.campaignaward_name }}</td>

                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="panel-body" style="font-size:120%;">
                        <div style="text-align:center">
                            <span class="lead">No new awards were reached yesterday. Lets try harder today!</span>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="panel panel-info" data-mh="row-2">
                <div class="panel-heading">Top
                    {{ ranking_limit }}
                    Class Rankings -
                    <a href="{{ path('classroom_index', {'campaignUrl':campaign.url}) }}">
                        <small>(click here to view all)</small>
                    </a>
                </div>
                {% if classroom_rankings | length > 0 %}
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Classroom</th>
                                <th>Amount</th>

                            </tr>
                        </thead>
                        <tbody>
                            {% for classroom_ranking in classroom_rankings %}
                                <tr>
                                    <td style="text-align:center;vertical-align: middle;">
                                        <span class="label label-{% if classroom_ranking.rank == 1 %}success{% elseif classroom_ranking.rank == 2 %}warning{% elseif classroom_ranking.rank == 3 %}primary{% else %}default{% endif %}">{{ classroom_ranking.rank }}</span>
                                    </td>
                                    <td>
                                        <a href="{{ path('classroom_show', { 'campaignUrl':campaign.url, 'id': classroom_ranking.id }) }}">{{ classroom_ranking.grade_name }}
                                            -
                                            {{ classroom_ranking.classroom_name }}</a>
                                    </td>
                                    <td style="text-align:right;">${{ classroom_ranking.donation_amount|number_format(2, '.', ',') }}</td>

                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="panel-body" style="font-size:120%;">
                        <div style="text-align:center">
                            <span class="lead">Not enough data to calculate classroom rankings</span>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="col-sm-6">
            <div class="panel panel-info" data-mh="row-2">
                <div class="panel-heading">Top
                    {{ ranking_limit }}
                    Student Rankings</div>
                {% if student_rankings | length > 0 %}
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Classroom</th>
                                <th>Student</th>
                                <th>Amount</th>

                            </tr>
                        </thead>
                        <tbody>
                            {% for student_ranking in student_rankings %}
                                <tr>
                                    <td style="text-align:center;vertical-align: middle;">
                                        <span class="label label-{% if student_ranking.rank == 1 %}success{% elseif student_ranking.rank == 2 %}warning{% elseif student_ranking.rank == 3 %}primary{% else %}default{% endif %}">{{ student_ranking.rank }}</span>
                                    </td>
                                    <td>
                                        {% if is_granted('ROLE_USER') %}
                                            <a href="{{ path('classroom_show', { 'campaignUrl':campaign.url, 'id': student_ranking.classroom_id }) }}">{{ student_ranking.classroom_name }}</a>
                                        {% else %}{{ student_ranking.classroom_name }}{% endif %}
                                    </td>
                                    <td>
                                        {{ student_ranking.student_name }}
                                    </td>
                                    <td style="text-align:right;">${{ student_ranking.donation_amount|number_format(2, '.', ',') }}</td>

                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="panel-body" style="font-size:120%;">
                        <div style="text-align:center">
                            <span class="lead">Not enough data to calculate classroom rankings</span>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
<script type='application/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.2/Chart.min.js"></script>
<script type="application/javascript" src="https://cdn.datatables.net/v/bs/dt-1.10.12/fh-3.1.2/r-2.1.0/sc-1.4.2/datatables.min.js"></script>
<script type='application/javascript' src="{{ asset('assets/js/libs/jquery.countdown.min.js') }}"></script>

    <script>
        $('[data-countdown]').each(function() {
            var $this = $(this),
                finalDate = $(this).data('countdown');
            $this.countdown(finalDate, function(event) {
                $this.html(event.strftime('<span class="label label-danger">%D</span> day%!D &nbsp;&nbsp;<span class="label label-danger">%H</span> hours &nbsp;&nbsp;<span class="label label-danger">%M</span> min<span class="hidden-sm"> &nbsp;&nbsp;<span class="label label-danger">%S</span> s' +
                        'ec</span>'));
            });
        });
    </script>
{% endblock %}
