{% extends 'crud.html.twig' %}

{% block body %}
    <div class="row dashboard">
        <div class="col-sm-12">
            <div class="panel panel-info" data-mh="row-1" style="text-align:center;vertical-align: middle;">
                <div class="panel-heading">Overall Campaign Progress, as of -
                    <strong>{{ report_date|date("l, F d, Y") }}</strong>
                </div>
                <div class="panel-body dashboard-ticker">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="progress">
                                <div
                                    class="progress-bar progress-bar-warning"
                                    role="progressbar"
                                    aria-valuenow="{{ totals.donation_amount / campaign_settings.campaign_funding_goal * 100}}"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                    style="width:{{ totals.donation_amount / campaign_settings.campaign_funding_goal * 100}}%">
                                    <span>{{ (totals.donation_amount / campaign_settings.campaign_funding_goal * 100)|number_format(2, '.', ',')}}% Complete</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4" style="text-align:center;vertical-align: middle;">
                            <strong>
                                ${{ totals.donation_amount|number_format(2, '.', ',') }}
                                / ${{ campaign_settings.campaign_funding_goal|number_format(2, '.', ',') }}</strong>
                        </div>
                        <div class="col-sm-4" style="text-align:center;vertical-align: middle;">
                            <div id="track" data-countdown="{{ campaign_settings.campaign_end_date|date('Y/m/d') }}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-info">
                <div class="panel-heading">New Class Awards -
                <a href="{{ path('public_teacher_awards') }}">
                    <small>(click here to view all)</small>
                </a></div>
                {% if new_teacher_awards | length > 0 %}
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>Teacher</th>
                                <th>Total Donations</th>
                                <th>Award Level</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for teacher in new_teacher_awards %}
                                <tr>
                                    <td>

                                        <a href="{{ path('public_teacher_show', { 'id': teacher.id }) }}">
                                            <span class="hidden-xs">{{ teacher.grade_name }}
                                                -</span>
                                            {{ teacher.teacher_name }}</a>
                                    </td>
                                    <td>${{ teacher.cumulative_donation_amount|number_format(2, '.', ',') }}
                                        <span class="hidden-xs">
                                            <small>(<span style="color:#5cb85c;">+{{ teacher.donation_amount|number_format(2, '.', ',') }}</span>)</small>
                                        </span>
                                    </td>
                                    <td>${{ teacher.campaignaward_amount }}
                                        -
                                        {{ teacher.campaignaward_name }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="panel-body" style="font-size:120%;">
                        <div style="text-align:center">
                            <span class="lead">No new awards were reached yesterday. Lets try harder today!</span>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="panel panel-info" data-mh="row-2">
                <div class="panel-heading">Top
                    {{ ranking_limit }}
                    Class Rankings -
                    <a href="{{ path('public_teacher_index') }}">
                        <small>(click here to view all)</small>
                    </a>
                </div>
                {% if teacher_rankings | length > 0 %}
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Teacher</th>
                                <th>Amount</th>

                            </tr>
                        </thead>
                        <tbody>
                            {% for teacher_ranking in teacher_rankings %}
                                <tr>
                                    <td style="text-align:center;vertical-align: middle;">
                                        <span class="label label-{% if teacher_ranking.rank == 1 %}success{% elseif teacher_ranking.rank == 2 %}warning{% elseif teacher_ranking.rank == 3 %}primary{% else %}default{% endif %}">{{ teacher_ranking.rank }}</span>
                                    </td>
                                    <td>
                                        <a href="{{ path('public_teacher_show', { 'id': teacher_ranking.id }) }}">{{ teacher_ranking.grade_name }}
                                            -
                                            {{ teacher_ranking.teacher_name }}</a>
                                    </td>
                                    <td style="text-align:right;">${{ teacher_ranking.donation_amount|number_format(2, '.', ',') }}</td>

                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="panel-body" style="font-size:120%;">
                        <div style="text-align:center">
                            <span class="lead">Not enough data to calculate teacher rankings</span>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="col-sm-6">
            <div class="panel panel-info" data-mh="row-2">
                <div class="panel-heading">Top
                    {{ ranking_limit }}
                    Student Rankings</div>
                {% if student_rankings | length > 0 %}
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Teacher</th>
                                <th>Student</th>
                                <th>Amount</th>

                            </tr>
                        </thead>
                        <tbody>
                            {% for student_ranking in student_rankings %}
                                <tr>
                                    <td style="text-align:center;vertical-align: middle;">
                                        <span class="label label-{% if student_ranking.rank == 1 %}success{% elseif student_ranking.rank == 2 %}warning{% elseif student_ranking.rank == 3 %}primary{% else %}default{% endif %}">{{ student_ranking.rank }}</span>
                                    </td>
                                    <td>
                                        {% if is_granted('ROLE_USER') %}
                                            <a href="{{ path('teacher_show', { 'id': student_ranking.teacher_id }) }}">{{ student_ranking.teacher_name }}</a>
                                        {% else %}{{ student_ranking.teacher_name }}{% endif %}
                                    </td>
                                    <td>
                                        {% if is_granted('ROLE_USER') %}
                                            <a href="{{ path('student_show', { 'id': student_ranking.id }) }}">{{ student_ranking.student_name }}</a>
                                        {% else %}{{ student_ranking.student_name }}{% endif %}
                                    </td>
                                    <td style="text-align:right;">${{ student_ranking.donation_amount|number_format(2, '.', ',') }}</td>

                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="panel-body" style="font-size:120%;">
                        <div style="text-align:center">
                            <span class="lead">Not enough data to calculate teacher rankings</span>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    <script>
        $('[data-countdown]').each(function() {
            var $this = $(this),
                finalDate = $(this).data('countdown');
            $this.countdown(finalDate, function(event) {
                $this.html(event.strftime('<span class="label label-danger">%D</span> day%!D &nbsp;&nbsp;<span class="label label-danger">%H</span> hours &nbsp;&nbsp;<span class="label label-danger">%M</span> min<span class="hidden-sm"> &nbsp;&nbsp;<span class="label label-danger">%S</span> s' +
                        'ec</span>'));
            });
        });
    </script>
{% endblock %}
